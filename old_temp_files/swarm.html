<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js and plugin for color scale -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>

var margin = {top: 10, right: 30, bottom: 30, left: 40},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

          d3.csv("C:/Users/yumai/GITHUB/Project_03/Resources/stroke_bio.csv", function(data) {
            var y = d3.scaleLinear()
                .domain([ 3.5,8 ]) 
                .range([height, 0])
            svg.append("g").call( d3.axisLeft(y) )

            var x = d3.scaleBand()
                .range([ 0, width ])
                .domain(["NORMAL", "PREDIABETIC", "DIABETIC", "HYPOGLYCEMIC"])
                .padding(0.05)
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
            
            var histogram = d3.histogram()
                .domain(y.domain())
                .thresholds(y.ticks(20))
                .value(d => d)
            
            var sumstat = d3.nest()
                .key(function(d) { return d.avg_glucose_level;})
                .rollup(function(d) {
                    input = d.map(function(g) {return g.bmi})
                    bins = histogram(input)
                    return(bins)
            })
            entries(data)

            var maxNum = 50
            for (i in sumstat){
                allBins = sumstat[i].value
                weight = allBins.map(function(a){return a.bmi;})
                longest = d3.mac(weight)
                if (longest > maxNum) {maxNum = longest}
            }

            var xNum = d3.scaleLinear()
                .range([0, x.bandwidth()])
                .domain([-maxNum,maxNum])
            
            var myColor = d3.scaleSequential()
                .interpolator(d3.interpolateInferno)
                 .domain([3,9])
            
            svg
                .selectAll("myViolin")
                .data(sumstat)
            .enter()       
            .append("g")
                .attr("transform", function(d){ return("translate(" + x(d.key) +" ,0)") } ) // Translation on the right to be at the group position
            .append("path")
                .datum(function(d){ return(d.value)})
                .style("stroke", "none")
                .style("fill","grey")
                .attr("d", d3.area()
                    .x0( xNum(0) )
                    .x1(function(d){ return(xNum(d.bmi)) } )
                    .y(function(d){ return(y(d.x0)) } )
                    .curve(d3.curveCatmullRom) 
            )

            var jitterWidth = 40
            svg
                .selectAll("indPoints")
                .data(data)
                .enter()
                .append("circle")
                    .attr("cx", function(d){return(x(d.avg_glucose_level) + x.bandwidth()/2 - Math.random()*jitterWidth )})
                    .attr("cy", function(d){return(y(d.bmi))})
                    .attr("r", 5)
                    .style("fill", function(d){ return(myColor(d.stroke))})
                    .attr("stroke", "white")
        })

</script>
</body>
</html>